# Libraries
library(tidyverse)
library(readxl)
library(kableExtra)
library(bookdown)
library(ggplot2)
library("janitor")
library("kableExtra")
library("plotly")
library("countrycode")
library(data.table)
# Chunk 2: read-data
# Read the data
WHR20 <- read_excel("Data/WHR20_DataForFigure2.1.xls")
# Chunk 3
happiness <- WHR20 %>%
select(`Country name`,`Regional indicator`,`Ladder score`,`Logged GDP per capita`,`Social support`,`Healthy life expectancy`,`Freedom to make life choices`,Generosity,`Perceptions of corruption`) %>%
mutate(`Happiness Rank` = rank(-`Ladder score`)) %>%
rename(`Happiness Score` = `Ladder score`) %>% clean_names()
#happiness rank : the more the ladder score the higher the rank
# Chunk 4: regiontable
reg_avg <- happiness %>%
select(regional_indicator,happiness_score) %>%
group_by(regional_indicator) %>%
summarize(Average = mean(happiness_score)) %>%
arrange(-Average)
# Chunk 5
happiness$iso3 <- countrycode(happiness$country_name, 'country.name', 'iso3c')
happiness[happiness$country_name=="Kosovo","iso3"] <- "XKX"
# Chunk 6: region
plot_ly(happiness, x=~regional_indicator,
y=~happiness_score,
type="box",
boxpoints="all",
color=~regional_indicator,
text = ~paste("<b>Region:</b> ", regional_indicator,
"<br><b>Country:</b> ", country_name,
"<br><b>Happiness Score:</b>", happiness_score))%>%
layout(xaxis=list(showticklabels = FALSE),
yaxis=list(title="Happiness Score"),
legend=list(font = (size = 5)),
margin=list(b = 100),
title="Box Plot of Happiness Score by Region")
# Chunk 7: GDP-ord
gdp_mean <- WHR20 %>%
group_by(`Regional indicator`) %>%
summarise(Average
= round(mean(`Logged GDP per capita`),2))%>%
arrange(-Average)
gdp_mean %>%
kable(caption = "Average Logged GDP per capita of Regions from High to Low") %>%
kable_styling(bootstrap_options = c("striped", "hover"))
# Chunk 9: GDP-high
WHR20 %>%
filter(!`Regional indicator` %in%
c("Commonwealth of Independent States",
"South Asia",
"Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Logged GDP per capita`)) +
geom_point() +
geom_vline(aes(xintercept = 5.47324),
linetype = "dashed") +
geom_hline(aes(yintercept =9.295706),
linetype = "dashed") +
facet_wrap(~`Regional indicator`, ncol = 3)
# Chunk 10: GDP-low
WHR20 %>%
filter(`Regional indicator` %in%
c("Commonwealth of Independent States",
"South Asia",
"Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Logged GDP per capita`)) +
geom_point() +
geom_vline(aes(xintercept = 5.47324),
linetype = "dashed") +
geom_hline(aes(yintercept =9.295706),
linetype = "dashed") +
facet_wrap(~`Regional indicator`, ncol = 3)
# Chunk 11: SS-ord
SS_mean <- WHR20 %>%
group_by(`Regional indicator`) %>%
summarise(Average
= round(mean(`Social support`),2))%>%
arrange(-Average)
SS_mean %>%
kable(caption = "Average Social Support of Regions from High to Low") %>%
kable_styling(bootstrap_options = c("striped", "hover"))
# Chunk 13: SS-high
WHR20 %>%
filter(!`Regional indicator` %in%
c("Middle East and North Africa",
"South Asia",
"Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Social support`)) +
geom_point() +
geom_vline(aes(xintercept = 5.47324),
linetype = "dashed") +
geom_hline(aes(yintercept = 0.8087211),
linetype = "dashed") +
facet_wrap(~`Regional indicator`, ncol = 3)
# Chunk 14: SS-low
WHR20 %>%
filter(`Regional indicator` %in%
c("Middle East and North Africa",
"South Asia",
"Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Social support`)) +
geom_point() +
geom_vline(aes(xintercept = 5.47324),
linetype = "dashed") +
geom_hline(aes(yintercept = 0.8087211),
linetype = "dashed") +
facet_wrap(~`Regional indicator`, ncol = 3)
# Chunk 15: HLE-ord
HLE_mean <- WHR20 %>%
group_by(`Regional indicator`) %>%
summarise(Average
= round(mean(`Healthy life expectancy`),2))%>%
arrange(-Average)
HLE_mean %>%
kable(caption = "Healthy life expectancy") %>%
kable_styling(bootstrap_options = c("striped", "hover"))
# Chunk 17: HLE-high
WHR20 %>%
filter(!`Regional indicator` %in%
c("South Asia",
"Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Healthy life expectancy`)) +
geom_point() +
geom_vline(aes(xintercept = 5.47324),
linetype = "dashed") +
geom_hline(aes(yintercept = 64.44553),
linetype = "dashed") +
facet_wrap(~`Regional indicator`, ncol = 3)
# Chunk 18: HLE-low
WHR20 %>%
filter(`Regional indicator` %in%
c("South Asia",
"Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Healthy life expectancy`)) +
geom_point() +
geom_vline(aes(xintercept = 5.47324),
linetype = "dashed") +
geom_hline(aes(yintercept = 64.44553),
linetype = "dashed") +
facet_wrap(~`Regional indicator`, ncol = 3)
# Chunk 20
free_avg <- WHR20 %>%
group_by(`Regional indicator`) %>%
summarise(average = mean(`Freedom to make life choices`)) %>%
arrange(desc(average))
# Chunk 21: tabfree
knitr::kable(free_avg, caption = "The Average Freedom to Make Life Choices Score by Region",
col.names = c("Region", "Average Score")) %>%
kable_styling(c("hover",
"condensed",
position = "center",
fixed_thead = TRUE))
# Chunk 22: freeh
WHR20 %>%
filter(`Regional indicator` %in% c("Southeast Asia",  "North America and ANZ", "Western Europe", "Latin America and Caribbean")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`)+
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
# Chunk 23: freem
WHR20 %>%
filter(`Regional indicator` %in% c("Commonwealth of Independent States", "South Asia", "Central and Eastern Europe", "East Asia")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
# Chunk 24: freel
WHR20 %>%
filter(`Regional indicator` %in% c("Sub-Saharan Africa", "Middle East and North Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
# Chunk 25: tabgene
gene_avg  <- WHR20 %>%
group_by(`Regional indicator`) %>%
summarise(average = mean(`Generosity`)) %>%
arrange(desc(average))
knitr::kable(gene_avg, caption = "The Average Generosity Score by Region",
col.names = c("Region", "Average Score")) %>%
kable_styling(c("hover",
"condensed",
position = "center",
fixed_thead = TRUE))
# Chunk 26: geneh
WHR20 %>%
filter(`Regional indicator` %in% c("North America and ANZ","Southeast Asia","Western Europe","South Asia","Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Generosity`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Generosity`)),
linetype = "dashed")
# Chunk 27: genel
WHR20 %>%
filter(`Regional indicator` %in% c("Commonwealth of Independent States","East Asia","Latin America and Caribbean","Middle East and North Africa","Central and Eastern Europe")) %>%
ggplot(aes(x = `Ladder score`,
y = `Generosity`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Generosity`)),
linetype = "dashed")
# Chunk 28: tabcor
perc_avg  <- WHR20 %>%
group_by(`Regional indicator`) %>%
summarise(average = mean(`Perceptions of corruption`)) %>%
arrange(desc(average))
knitr::kable(perc_avg, caption = "The Perceptions of Corruption Score by Region",
col.names = c("Region", "Average Score")) %>%
kable_styling(c("hover",
"condensed",
position = "center",
fixed_thead = TRUE))
# Chunk 29: corl
WHR20 %>%
filter(`Regional indicator` %in% c("Western Europe","North America and ANZ")) %>%
ggplot(aes(x = `Ladder score`,
y = `Perceptions of corruption`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Perceptions of corruption`)),
linetype = "dashed")
# Chunk 30: corm
WHR20 %>%
filter(`Regional indicator` %in% c("South Asia","Sub-Saharan Africa","Middle East and North Africa", "Commonwealth of Independent States","Southeast Asia","East Asia")) %>%
ggplot(aes(x = `Ladder score`,
y = `Perceptions of corruption`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Perceptions of corruption`)),
linetype = "dashed")
# Chunk 31: corh
WHR20 %>%
filter(`Regional indicator` %in% c("Central and Eastern Europe","Latin America and Caribbean")) %>%
ggplot(aes(x = `Ladder score`,
y = `Perceptions of corruption`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Perceptions of corruption`)),
linetype = "dashed")
# Chunk 32
top5 <- happiness %>% head(5) %>% mutate(Level = "TOP5")
middle5 <- happiness[76:80, ] %>% mutate(Level = "MIDDLE5")
worst5 <- happiness %>% tail(5) %>% mutate(Level = "WORST5")
comparison <- bind_rows(top5, middle5, worst5)
comparison$Level <- as.factor(comparison$Level)
comparison <- transform(comparison, Level = factor(Level, levels = c("TOP5", "MIDDLE5", "WORST5" )))
# Chunk 33
data.table(comparison,
options = list(
lengthMenu = c(5, 10, 15)
),
caption =
htmltools::tags$caption(
style = 'caption-side: bottom; text-align: center;',
htmltools::em('Data table that only includes top5, middle5 and worst5 countries'))
)
# Chunk 34
comparison.score <- comparison %>% rename("Economy GDP" = "logged_gdp_per_capita" , "Social Support" = "social_support" , "Health" = "healthy_life_expectancy", "Freedom" = "freedom_to_make_life_choices", "Corruption" ="perceptions_of_corruption") %>%
gather(key = "columns", value = "score", happiness_score:Corruption)
# Chunk 35: compare
comparison.score %>%
ggplot(aes(x = Level, y = score, colour = Level, fill = Level)) +
geom_boxplot(position=position_dodge(width=1)) + facet_wrap(~columns, scales = "free")
# Chunk 36: map
fig <- plot_ly(happiness, type='choropleth', locations= happiness$iso3 , z= happiness$happiness_score, text= ~paste(
"<br><b>Country:</b> ", country_name,
"<br><b>Happiness rank:</b>", happiness_rank), colorscale="Viridis")
fig <- fig %>% colorbar(title = "Happiness Score" )
fig <- fig %>% layout(
title = 'World Happiness Map, Year 2020')
fig
WHR20 %>%
filter(`Regional indicator` %in% c("Southeast Asia",  "North America and ANZ", "Western Europe", "Latin America and Caribbean")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`)+
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Southeast Asia",  "North America and ANZ", "Western Europe", "Latin America and Caribbean")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`)+
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Sub-Saharan Africa", "Middle East and North Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Commonwealth of Independent States", "South Asia", "Central and Eastern Europe", "East Asia")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Sub-Saharan Africa", "Middle East and North Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Freedom to make life choices`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Freedom to make life choices`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("North America and ANZ","Southeast Asia","Western Europe","South Asia","Sub-Saharan Africa")) %>%
ggplot(aes(x = `Ladder score`,
y = `Generosity`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Generosity`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Commonwealth of Independent States","East Asia","Latin America and Caribbean","Middle East and North Africa","Central and Eastern Europe")) %>%
ggplot(aes(x = `Ladder score`,
y = `Generosity`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Generosity`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Commonwealth of Independent States","East Asia","Latin America and Caribbean","Middle East and North Africa","Central and Eastern Europe")) %>%
ggplot(aes(x = `Ladder score`,
y = `Generosity`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Generosity`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Western Europe","North America and ANZ")) %>%
ggplot(aes(x = `Ladder score`,
y = `Perceptions of corruption`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Perceptions of corruption`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("South Asia","Sub-Saharan Africa","Middle East and North Africa", "Commonwealth of Independent States","Southeast Asia","East Asia")) %>%
ggplot(aes(x = `Ladder score`,
y = `Perceptions of corruption`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Perceptions of corruption`)),
linetype = "dashed")
WHR20 %>%
filter(`Regional indicator` %in% c("Central and Eastern Europe","Latin America and Caribbean")) %>%
ggplot(aes(x = `Ladder score`,
y = `Perceptions of corruption`)) +
geom_point() +
facet_grid(~`Regional indicator`) +
geom_vline(aes(xintercept = mean(WHR20$`Ladder score`)),
linetype = "dashed") +
geom_hline(aes(yintercept = mean(WHR20$`Perceptions of corruption`)),
linetype = "dashed")
happiness <- WHR20 %>%
select(`Country name`,`Regional indicator`,`Ladder score`,`Logged GDP per capita`,`Social support`,`Healthy life expectancy`,`Freedom to make life choices`,Generosity,`Perceptions of corruption`) %>%
mutate(`Happiness Rank` = rank(-`Ladder score`)) %>%
rename(`Happiness Score` = `Ladder score`) %>% clean_names()
#happiness rank : the more the ladder score the higher the rank
reg_avg <- happiness %>%
select(regional_indicator,happiness_score) %>%
group_by(regional_indicator) %>%
summarize(Average = mean(happiness_score)) %>%
arrange(-Average)
happiness <- WHR20 %>%
select(`Country name`,`Regional indicator`,`Ladder score`,`Logged GDP per capita`,`Social support`,`Healthy life expectancy`,`Freedom to make life choices`,Generosity,`Perceptions of corruption`) %>%
mutate(`Happiness Rank` = rank(-`Ladder score`)) %>%
rename(`Happiness Score` = `Ladder score`) %>% clean_names()
#happiness rank : the more the ladder score the higher the rank
happiness <- WHR20 %>%
select(`Country name`,`Regional indicator`,`Ladder score`,`Logged GDP per capita`,`Social support`,`Healthy life expectancy`,`Freedom to make life choices`,Generosity,`Perceptions of corruption`) %>%
mutate(`Happiness Rank` = rank(-`Ladder score`)) %>%
rename(`Happiness Score` = `Ladder score`) %>% clean_names()
#happiness rank : the more the ladder score the higher the rank
happiness$iso3 <- countrycode(happiness$country_name, 'country.name', 'iso3c')
happiness[happiness$country_name=="Kosovo","iso3"] <- "XKX"
plot_ly(happiness, x=~regional_indicator,
y=~happiness_score,
type="box",
boxpoints="all",
color=~regional_indicator,
text = ~paste("<b>Region:</b> ", regional_indicator,
"<br><b>Country:</b> ", country_name,
"<br><b>Happiness Score:</b>", happiness_score))%>%
layout(xaxis=list(showticklabels = FALSE),
yaxis=list(title="Happiness Score"),
legend=list(font = (size = 5)),
margin=list(b = 100),
title="Box Plot of Happiness Score by Region")
top5 <- happiness %>% head(5) %>% mutate(Level = "TOP5")
middle5 <- happiness[76:80, ] %>% mutate(Level = "MIDDLE5")
worst5 <- happiness %>% tail(5) %>% mutate(Level = "WORST5")
comparison <- bind_rows(top5, middle5, worst5)
comparison$Level <- as.factor(comparison$Level)
comparison <- transform(comparison, Level = factor(Level, levels = c("TOP5", "MIDDLE5", "WORST5" )))
data.table(comparison,
options = list(
lengthMenu = c(5, 10, 15)
),
caption =
htmltools::tags$caption(
style = 'caption-side: bottom; text-align: center;',
htmltools::em('Data table that only includes top5, middle5 and worst5 countries'))
)
comparison.score <- comparison %>% rename("Economy GDP" = "logged_gdp_per_capita" , "Social Support" = "social_support" , "Health" = "healthy_life_expectancy", "Freedom" = "freedom_to_make_life_choices", "Corruption" ="perceptions_of_corruption") %>%
gather(key = "columns", value = "score", happiness_score:Corruption)
comparison.score %>%
ggplot(aes(x = Level, y = score, colour = Level, fill = Level)) +
geom_boxplot(position=position_dodge(width=1)) + facet_wrap(~columns, scales = "free")
fig <- plot_ly(happiness, type='choropleth', locations= happiness$iso3 , z= happiness$happiness_score, text= ~paste(
"<br><b>Country:</b> ", country_name,
"<br><b>Happiness rank:</b>", happiness_rank), colorscale="Viridis")
fig <- fig %>% colorbar(title = "Happiness Score" )
fig <- fig %>% layout(
title = 'World Happiness Map, Year 2020')
fig
gene_avg  <- WHR20 %>%
group_by(`Regional indicator`) %>%
summarise(average = mean(`Generosity`)) %>%
arrange(desc(average))
knitr::kable(gene_avg, caption = "The Average Generosity Score by Region",
col.names = c("Region", "Average Score")) %>%
kable_styling(c("hover",
"condensed",
position = "center",
fixed_thead = TRUE))
fig <- plot_ly(happiness, type='choropleth', locations= happiness$iso3 , z= happiness$happiness_score, text= ~paste(
"<br><b>Country:</b> ", country_name,
"<br><b>Happiness rank:</b>", happiness_rank), colorscale="Viridis")
fig <- fig %>% colorbar(title = "Happiness Score" )
fig <- fig %>% layout(
title = 'World Happiness Map, Year 2020')
fig
comparison.score %>%
ggplot(aes(x = Level, y = score, colour = Level, fill = Level)) +
geom_boxplot(position=position_dodge(width=1)) + facet_wrap(~columns, scales = "free")
plot_ly(happiness, x=~regional_indicator,
y=~happiness_score,
type="box",
boxpoints="all",
color=~regional_indicator,
text = ~paste("<b>Region:</b> ", regional_indicator,
"<br><b>Country:</b> ", country_name,
"<br><b>Happiness Score:</b>", happiness_score))%>%
layout(xaxis=list(showticklabels = FALSE),
yaxis=list(title="Happiness Score"),
legend=list(font = (size = 5)),
margin=list(b = 100),
title="Box Plot of Happiness Score by Region")
glimpse(WHR20)
