---
title: "World Happiness Report 2020"
author:
- familyname: Luo
  othernames: Yu
  address: Monash University
  email: yluo0065@student.monash.com
  correspondingauthor: true
  qualifications:  Master
- familyname: Thakker
  othernames: Khushee
  address: Monash University
  email: ktha0021@student.monash.edu
  qualifications: Master
- familyname: Chen
  othernames: Yunqi
  address: Monash University
  email: yche0454@student.monash.edu
  correspondingauthor: true
  qualifications:  Master
organization: the World Bank data base
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
editor_options: 
  chunk_output_type: console
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message=FALSE, 
                      warning=FALSE,
                      fig.width = 6, 
                      fig.height = 4,
                      fig.align="center")
knitr::opts_chunk$set(fig.pos = "!h", out.extra = "")

# Libraries

library(tidyverse)
library(readxl)
library(kableExtra)
library(bookdown)
library(ggplot2)
library(stringr)
library(lubridate)
```


```{r read-data}
# Read the data
WHR20 <- read_excel("Data/WHR20_DataForFigure2.1.xls")
```

\section*{Introduction}

\section*{1 }
```{r}
library("janitor")
library("kableExtra")
library("plotly")
library("countrycode")
library(data.table)
```

```{r}
happiness <- WHR20 %>% 
  select(`Country name`,`Regional indicator`,`Ladder score`,`Logged GDP per capita`,`Social support`,`Healthy life expectancy`,`Freedom to make life choices`,Generosity,`Perceptions of corruption`) %>% 
  mutate(`Happiness Rank` = rank(-`Ladder score`)) %>% 
  rename(`Happiness Score` = `Ladder score`) %>% clean_names()

#happiness rank : the more the ladder score the higher the rank              

```

```{r regiontable}
reg_avg <- happiness %>%
  select(regional_indicator,happiness_score) %>%
  group_by(regional_indicator) %>%
  summarize(Average = mean(happiness_score)) %>% 
  arrange(-Average)

```

```{r}
happiness$iso3 <- countrycode(happiness$country_name, 'country.name', 'iso3c')

happiness[happiness$country_name=="Kosovo","iso3"] <- "XKX"


```

```{r fig.align='center',fig.height=5,fig.width=8}
plot_ly(happiness, x=~regional_indicator,
              y=~happiness_score,
              type="box",
              boxpoints="all",
              color=~regional_indicator,
        text = ~paste("<b>Region:</b> ", regional_indicator,
                      "<br><b>Country:</b> ", country_name,
                      "<br><b>Happiness Score:</b>", happiness_score))%>%
  layout(xaxis=list(showticklabels = FALSE),
         yaxis=list(title="Happiness Score"),
         legend=list(font = (size = 5)),
         margin=list(b = 100),
         title="Box Plot of Happiness Score by Region")
```


From the box plot we see that the happiness scores are quite different among these regions. Overall countries in Western Europe has highest happiness score compared to countries in other region.

  




\subsection*{1.2 }


\clearpage
\section*{2 }

\subsection*{2.1 }

\clearpage
\section*{3 }

\subsection*{3.1 }

```{r  fig.width=8}

fig <- plot_ly(happiness, type='choropleth', locations= happiness$iso3 , z= happiness$happiness_score, text= ~paste(
                      "<br><b>Country:</b> ", country_name,
                      "<br><b>Happiness rank:</b>", happiness_rank), colorscale="Viridis")

fig <- fig %>% colorbar(title = "Happiness Score" )

fig <- fig %>% layout(
    title = 'World Happiness Map, Year 2020')
fig

```


* Compare Top5, Middle5 and Worst5 Countries

```{r include=FALSE}
top5 <- happiness %>% head(5) %>% mutate(Level = "TOP5")
middle5 <- happiness[76:80, ] %>% mutate(Level = "MIDDLE5")
worst5 <- happiness %>% tail(5) %>% mutate(Level = "WORST5")

comparison <- bind_rows(top5, middle5, worst5)

comparison$Level <- as.factor(comparison$Level)
comparison <- transform(comparison, Level = factor(Level, levels = c("TOP5", "MIDDLE5", "WORST5" )))
```

```{r include=FALSE}

data.table(comparison,
          options = list(
            lengthMenu = c(5, 10, 15)
          ),
          caption = 
            htmltools::tags$caption(
              style = 'caption-side: bottom; text-align: center;', 
              htmltools::em('Data table that only includes top5, middle5 and worst5 countries'))
          )

```

```{r include=FALSE}
comparison.score <- comparison %>% rename("Economy GDP" = "logged_gdp_per_capita" , "Social Support" = "social_support" , "Health" = "healthy_life_expectancy", "Freedom" = "freedom_to_make_life_choices", "Corruption" ="perceptions_of_corruption") %>% 
  gather(key = "columns", value = "score", happiness_score:Corruption)

```


```{r  fig.width=10}
comparison.score %>% 
  ggplot(aes(x = Level, y = score, colour = Level, fill = Level)) + 
  geom_boxplot(position=position_dodge(width=1)) + facet_wrap(~columns, scales = "free") 

```

\clearpage
\section*{References}


